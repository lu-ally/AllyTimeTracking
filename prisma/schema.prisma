generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  USER
  ADMIN
}

enum VacationStatus {
  PENDING
  APPROVED
  REJECTED
}

model User {
  id                  String   @id @default(cuid())
  email               String   @unique
  name                String
  password            String
  role                Role     @default(USER)
  weeklyHours         Float    @default(40.0)
  vacationDaysPerYear Float    @default(30.0)
  isActive            Boolean  @default(true)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  timeEntries      TimeEntry[]
  vacationEntries  VacationEntry[]
  vacationBalances VacationBalance[]
}

model TimeEntry {
  id           String   @id @default(cuid())
  userId       String
  date         DateTime @db.Date
  startTime    String   // "HH:mm" format
  endTime      String   // "HH:mm" format
  breakMinutes Int      @default(0)
  notes        String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, date])
  @@index([userId])
  @@index([date])
}

model VacationEntry {
  id           String         @id @default(cuid())
  userId       String
  startDate    DateTime       @db.Date
  endDate      DateTime       @db.Date
  halfDayStart Boolean        @default(false)
  halfDayEnd   Boolean        @default(false)
  status       VacationStatus @default(APPROVED)
  notes        String?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([startDate, endDate])
}

model VacationBalance {
  id               String   @id @default(cuid())
  userId           String
  year             Int
  annualEntitlement Float   @default(30.0)
  carryOver        Float    @default(0)
  correction       Float    @default(0)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, year])
  @@index([userId])
}
